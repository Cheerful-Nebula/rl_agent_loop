Implement the following improvement plan to fix the RL reward function.

## The Plan
{plan}

## Existing Code (Reference)
```python
{current_code}
```
## Instructions
- Rewrite the calculate_reward function based on the plan.
- Keep function signature exactly the same.
- Include neccesary imports above function signature
- Return ONLY valid Python code inside python blocks.
