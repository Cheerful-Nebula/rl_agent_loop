Implement the following improvement plan to fix the RL reward function.

## The Plan
{plan}

## Existing Code (Reference)
```python
{current_code}
```
## Instructions
- Rewrite the calculate_reward function based on the plan.
- Keep imports and function signature exactly the same.
- Return ONLY valid Python code inside python blocks.
